@using Facepunch.Gunfight.UI
@using Sandbox.Menu
@using Sandbox.UI;

@inherits Sandbox.UI.NavHostPanel
@implements Sandbox.Menu.IGameMenuPanel
@attribute [StyleSheet]
@namespace Facepunch.Gunfight.MainMenu

<root>
	<div class="background" />
	<div class="overlay" />
	<div class="navigator-canvas" slot="navigator-canvas" />
	
	<div class="footer">
    	<div style="flex-grow: 1;"/>
    	<label>Developed by Facepunch Studios</label>
    	<div class="logo" />
    </div>
	
	<div class="matchmaking">
		<MatchmakingWidget />
	</div>

    <NotificationOverlay />
</root>

@code
{
	static GunfightLobby _currentLobby;
	public static GunfightLobby CurrentLobby
	{
		get
		{
			if ( _currentLobby == null && Game.Menu.Lobby != null ) _currentLobby = new GunfightLobby( Game.Menu.Lobby );

			return _currentLobby;
		}
		set
		{
			_currentLobby = value;
		}
	}

	public MainMenu()
    {
        DefaultUrl = "/splash";
	    AddDestination( "/", typeof( LandingPage ) );
	    AddDestination( "/stats", typeof( StatsPage ) );
		AddDestination( "/find", typeof( MatchmakerPage ) );
		AddDestination( "/servers", typeof( ServerListPage ) );
	    AddDestination( "/lobby", typeof( GameLobbyPage ) );
		AddDestination( "/ingame", typeof( PauseMenu ) );
		AddDestination( "/splash", typeof( SplashPage ) );
	    
	    BindClass( "ingame", () => Game.InGame );
    }

	[GameEvent.Menu.ServerJoined]
	public void OnServerJoined()
	{
		Navigate( "/ingame" );
	}

	[GameEvent.Menu.LobbyJoined]
	public void OnLobbyJoined() => Navigate("/lobby" );

	[GameEvent.Menu.LobbyLeave]
	public void OnLobbyLeave() => Navigate("/");

	[GameEvent.Menu.ServerLeave]
	public void OnServerLeave() => Navigate("/");

	public override void Tick()
	{
		foreach ( var lobby in GunfightLobby.All )
		{
			lobby.Tick();
		}
	}

}
