@using Sandbox;
@using Sandbox.UI;
@using Sandbox.UI.Construct;

@inherits Panel
@namespace Facepunch.Gunfight.UI

<root class="@PlayerClasses() @MessageClasses() @HeaderClasses()">
    @if (SteamId != 0)
	{
		<div class="avatar">
            <img class="image" src="avatar:@SteamId" />
		</div>
	}

		<div class="header">
			<label class="name">@Name</label>
		</div>

	<div class="main">
		<label class="msg">@Message</label>
	</div>
</root>

@code
{
    public string Name { get; set; }
    public string Message { get; set; }
    public long SteamId { get; set; }
    public bool IsChatMessage { get; set; }
    public TimeSince Lifetime { get; init; } = 0;

	public string PlayerClasses()
	{
        if ( Game.SteamId != SteamId ) return "not-me";
		return "";
	}

	public string MessageClasses()
	{
		if ( !IsChatMessage ) return "not-message";
		return "";
	}

	public string HeaderClasses()
	{
        var cl = Game.Clients.FirstOrDefault( x => x.SteamId == SteamId );
		if ( cl == null ) return "disconnected";

		var friendState = TeamSystem.GetFriendState( cl.GetTeam(), TeamSystem.MyTeam );

		if ( friendState == TeamSystem.FriendlyStatus.Friendly ) return "friend";
		if ( friendState == TeamSystem.FriendlyStatus.Hostile ) return "enemy";
		if ( friendState == TeamSystem.FriendlyStatus.Neutral ) return "neutral";

		return "";
	}
}
